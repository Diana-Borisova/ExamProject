<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="/fragments/fragments::head"></head>
<body>
<nav th:replace="/fragments/fragments::navbar"></nav>
<main class="main p-5 align-content-center bg-blur">
    <h1 class="text-light border-bottom mt-2 mb-4">Your Recipes</h1>
    <div id="cardsList" class="container">
    </div>
</main>
<footer th:replace="/fragments/fragments::footer"></footer>
<script>
    const recipeList = document.getElementById('cardsList');
    const recipes = [];
    fetch("http://localhost:8080/recipes/api/owned")
        .then(response => response.json())
        .then(data => {
            for (let d of data) {
                recipes.push(d);
            }
        })
        .then(p => displayRecipes(recipes));

    const displayRecipes = (recipes) => {
        recipeList.innerHTML = '';
        let row = [];
        for (let i = 0; i < recipes.length; i++) {
            let card = document.createElement('div');
            card.classList.add('card');
            card.classList.add('my-card');
            let img = document.createElement('img');
            img.className = 'card-img-top card-image';
            img.src = recipes[i].image;
            img.alt = 'Card image cap';
            let cardBody = document.createElement('div');
            cardBody.className = 'card-body';
            let cardTitle = document.createElement('h5');
            cardTitle.className = 'card-title';
            cardTitle.innerText = recipes[i].title;
            let cardText = document.createElement('p');
            cardText.className = 'card-text';
            cardText.innerText = recipes[i].cookingTime;
            let buttonRow = document.createElement('div');
            buttonRow.classList.add('d-grid');
            buttonRow.classList.add('gap-2');
            buttonRow.classList.add('d-md-block');
            let visitBtn = document.createElement('a');
            visitBtn.className = 'btn btn-primary';
            visitBtn.href = '/recipes/details/' + recipes[i].id;
            visitBtn.innerText = 'Visit';
            let favoriteBtn = document.createElement('a');
            favoriteBtn.className = 'btn btn-danger m-1';
            favoriteBtn.href = 'users/favorites' + recipes[i].id;
            favoriteBtn.innerText = 'Favorites';
            buttonRow.appendChild(visitBtn);
            buttonRow.appendChild(favoriteBtn);
            cardBody.appendChild(cardTitle);
            cardBody.appendChild(cardText);
            cardBody.appendChild(buttonRow);
            card.appendChild(img);
            card.appendChild(cardBody);
            row.push(card);
            if ((i + 1) % 3 === 0 || recipes.length - i === 1) {
                let cardGroup = document.createElement('div');
                cardGroup.classList.add('card-group');
                cardGroup.classList.add('align-content-center');
                cardGroup.classList.add('mx-auto');
                for (let j = 0; j < row.length; j++) {
                    cardGroup.appendChild(row[j]);
                }
                recipesList.appendChild(cardGroup);
                row = [];
            }
        }
    }
</script>
</body>
</html>